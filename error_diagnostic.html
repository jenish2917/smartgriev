<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß SmartGriev - Error Diagnostic Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 36px;
        }
        .error-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .error-id {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            color: #fbbf24;
            margin: 10px 0;
        }
        .section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        h2 {
            color: #fbbf24;
            margin-bottom: 15px;
            font-size: 24px;
        }
        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .button:active {
            transform: translateY(0);
        }
        .button.primary {
            background: #10b981;
            border-color: #059669;
        }
        .button.primary:hover {
            background: #059669;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.2);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        .result.success { background: rgba(16, 185, 129, 0.2); border-left: 4px solid #10b981; }
        .result.error { background: rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444; }
        .result.warning { background: rgba(245, 158, 11, 0.2); border-left: 4px solid #f59e0b; }
        .result.info { background: rgba(59, 130, 246, 0.2); border-left: 4px solid #3b82f6; }
        .steps {
            counter-reset: step-counter;
            list-style: none;
        }
        .steps li {
            counter-increment: step-counter;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            position: relative;
            padding-left: 50px;
        }
        .steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 15px;
            top: 15px;
            background: #fbbf24;
            color: #1e40af;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .checkbox {
            margin: 10px 0;
            font-size: 16px;
        }
        .checkbox input {
            margin-right: 10px;
            transform: scale(1.3);
            cursor: pointer;
        }
        .checkbox label {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß SmartGriev Error Diagnostic Tool</h1>
        
        <div class="error-info">
            <h2>üö® Error Information</h2>
            <p><strong>Error Type:</strong> Critical Application Error</p>
            <div class="error-id">Error ID: err_1759740307464_3o28a1man</div>
            <p><strong>Message:</strong> "The application has encountered a critical error and needs to restart."</p>
            <p style="margin-top: 10px;"><strong>Status:</strong> <span id="diagnosis-status">Diagnosing...</span></p>
        </div>

        <div class="section">
            <h2>üéØ Quick Fix (Try This First!)</h2>
            <p><strong>‚ö†Ô∏è 90% of these errors are caused by cached old code!</strong></p>
            <button class="button primary" onclick="clearEverything()">üßπ Clear All Cache & Reload</button>
            <button class="button" onclick="testInIncognito()">üï∂Ô∏è How to Test in Incognito</button>
            <button class="button" onclick="hardRefresh()">üîÑ Hard Refresh Page</button>
            <div id="quick-fix-result"></div>
        </div>

        <div class="section">
            <h2>üîç Diagnostic Tests</h2>
            <button class="button" onclick="checkServers()">üñ•Ô∏è Check Servers</button>
            <button class="button" onclick="checkLocalStorage()">üíæ Check Storage</button>
            <button class="button" onclick="checkConsoleErrors()">üìã Check Console</button>
            <button class="button" onclick="testAPI()">üîå Test API</button>
            <button class="button" onclick="runAllTests()">üß™ Run All Tests</button>
            <div id="diagnostic-results"></div>
        </div>

        <div class="section">
            <h2>üìã Step-by-Step Fix Guide</h2>
            <ol class="steps">
                <li>
                    <strong>Clear Browser Cache</strong>
                    <div class="code">localStorage.clear();sessionStorage.clear();location.reload(true);</div>
                    <button class="button" onclick="doClearCache()">Do This Step</button>
                </li>
                <li>
                    <strong>Open Browser Console</strong>
                    <p>Press <code>F12</code> ‚Üí Go to <strong>Console</strong> tab ‚Üí Look for red error messages</p>
                    <button class="button" onclick="showConsoleHelp()">Show Console Errors</button>
                </li>
                <li>
                    <strong>Check Network Requests</strong>
                    <p>Press <code>F12</code> ‚Üí Go to <strong>Network</strong> tab ‚Üí Refresh page ‚Üí Look for failed requests</p>
                </li>
                <li>
                    <strong>Test in Incognito Mode</strong>
                    <p>Press <code>Ctrl + Shift + N</code> ‚Üí Navigate to <code>http://localhost:3001/</code></p>
                    <p>If it works in incognito ‚Üí It's a cache issue!</p>
                </li>
                <li>
                    <strong>Restart Development Servers</strong>
                    <div class="code">
                        Frontend: cd E:\Smartgriv\smartgriev\frontend; npm run dev<br>
                        Backend: cd E:\Smartgriv\smartgriev\backend; python manage.py runserver
                    </div>
                </li>
            </ol>
        </div>

        <div class="section">
            <h2>‚úÖ Diagnostic Checklist</h2>
            <div class="checkbox"><input type="checkbox" id="check1"><label for="check1">Cleared localStorage and sessionStorage</label></div>
            <div class="checkbox"><input type="checkbox" id="check2"><label for="check2">Checked browser console for errors (F12)</label></div>
            <div class="checkbox"><input type="checkbox" id="check3"><label for="check3">Tested in incognito/private mode</label></div>
            <div class="checkbox"><input type="checkbox" id="check4"><label for="check4">Verified frontend server is running (http://localhost:3001/)</label></div>
            <div class="checkbox"><input type="checkbox" id="check5"><label for="check5">Verified backend server is running (http://127.0.0.1:8000/)</label></div>
            <div class="checkbox"><input type="checkbox" id="check6"><label for="check6">Checked Network tab for failed requests</label></div>
            <div class="checkbox"><input type="checkbox" id="check7"><label for="check7">Restarted both dev servers</label></div>
            <div class="checkbox"><input type="checkbox" id="check8"><label for="check8">Tried a different browser</label></div>
        </div>

        <div class="section">
            <h2>üÜò Still Having Issues?</h2>
            <p>If the error persists after trying all steps above, we need more information:</p>
            <button class="button" onclick="collectDebugInfo()">üìä Collect Debug Information</button>
            <div id="debug-info"></div>
        </div>
    </div>

    <script>
        // Quick Fix Functions
        function clearEverything() {
            const result = document.getElementById('quick-fix-result');
            result.innerHTML = '<div class="result info">üßπ Clearing all cache...</div>';
            
            try {
                // Clear all storage
                localStorage.clear();
                sessionStorage.clear();
                
                // Clear cookies (if possible)
                document.cookie.split(";").forEach(c => {
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                });
                
                result.innerHTML = '<div class="result success">‚úÖ Cache cleared successfully! Page will reload in 2 seconds...</div>';
                
                setTimeout(() => {
                    location.reload(true);
                }, 2000);
            } catch (error) {
                result.innerHTML = '<div class="result error">‚ùå Error clearing cache: ' + error.message + '</div>';
            }
        }

        function testInIncognito() {
            const result = document.getElementById('quick-fix-result');
            result.innerHTML = `
                <div class="result info">
                    <strong>üï∂Ô∏è How to Test in Incognito/Private Mode:</strong><br><br>
                    <strong>Chrome/Edge:</strong> Press <code>Ctrl + Shift + N</code><br>
                    <strong>Firefox:</strong> Press <code>Ctrl + Shift + P</code><br>
                    <strong>Safari:</strong> Press <code>Cmd + Shift + N</code><br><br>
                    Then navigate to: <code>http://localhost:3001/</code><br><br>
                    <strong>Why?</strong> Incognito mode has no cache, so if it works there, the issue is definitely cached code!
                </div>
            `;
        }

        function hardRefresh() {
            const result = document.getElementById('quick-fix-result');
            result.innerHTML = '<div class="result info">üîÑ Hard refreshing page...</div>';
            setTimeout(() => {
                location.reload(true);
            }, 500);
        }

        // Diagnostic Functions
        async function checkServers() {
            const results = document.getElementById('diagnostic-results');
            results.innerHTML = '<div class="result info">üñ•Ô∏è Checking servers...</div>';
            
            let output = '';
            
            // Check Frontend
            try {
                const frontendResponse = await fetch('http://localhost:3001/', { method: 'HEAD' });
                output += '<div class="result success">‚úÖ Frontend server is running (http://localhost:3001/)</div>';
            } catch (error) {
                output += '<div class="result error">‚ùå Frontend server is NOT running - Start with: npm run dev</div>';
            }
            
            // Check Backend
            try {
                const backendResponse = await fetch('http://127.0.0.1:8000/api/auth/login/', { method: 'OPTIONS' });
                output += '<div class="result success">‚úÖ Backend server is running (http://127.0.0.1:8000/)</div>';
            } catch (error) {
                output += '<div class="result error">‚ùå Backend server is NOT running - Start with: python manage.py runserver</div>';
            }
            
            results.innerHTML = output;
        }

        function checkLocalStorage() {
            const results = document.getElementById('diagnostic-results');
            const items = Object.keys(localStorage);
            
            if (items.length === 0) {
                results.innerHTML = '<div class="result success">‚úÖ localStorage is empty (clean state)</div>';
            } else {
                let output = '<div class="result warning">‚ö†Ô∏è Found ' + items.length + ' items in localStorage:</div>';
                output += '<div class="result info">';
                items.forEach(key => {
                    output += '<strong>' + key + ':</strong> ' + localStorage.getItem(key).substring(0, 100) + '...<br>';
                });
                output += '</div>';
                output += '<button class="button" onclick="localStorage.clear();checkLocalStorage()">Clear Storage</button>';
                results.innerHTML = output;
            }
        }

        function checkConsoleErrors() {
            const results = document.getElementById('diagnostic-results');
            results.innerHTML = `
                <div class="result info">
                    <strong>üìã How to Check Console Errors:</strong><br><br>
                    1. Press <code>F12</code> or <code>Right-click ‚Üí Inspect</code><br>
                    2. Click on the <strong>Console</strong> tab<br>
                    3. Look for messages in <span style="color: #ef4444;">RED</span> (errors) or <span style="color: #f59e0b;">YELLOW</span> (warnings)<br>
                    4. Copy the error message and search for it<br><br>
                    <strong>Common errors to look for:</strong><br>
                    ‚Ä¢ "Cannot read property of undefined"<br>
                    ‚Ä¢ "Unexpected token"<br>
                    ‚Ä¢ "Failed to fetch"<br>
                    ‚Ä¢ "Network error"<br>
                    ‚Ä¢ "401 Unauthorized" or "404 Not Found"
                </div>
            `;
        }

        async function testAPI() {
            const results = document.getElementById('diagnostic-results');
            results.innerHTML = '<div class="result info">üîå Testing API connection...</div>';
            
            try {
                const response = await fetch('http://127.0.0.1:8000/api/auth/login/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'testuser', password: 'Test@123' })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    results.innerHTML = '<div class="result success">‚úÖ API is working! Login successful</div>';
                } else {
                    results.innerHTML = '<div class="result error">‚ùå API error: HTTP ' + response.status + '</div>';
                }
            } catch (error) {
                results.innerHTML = '<div class="result error">‚ùå Cannot connect to API: ' + error.message + '<br>Make sure backend server is running!</div>';
            }
        }

        async function runAllTests() {
            const results = document.getElementById('diagnostic-results');
            results.innerHTML = '<div class="result info">üß™ Running comprehensive diagnostics...</div>';
            
            await checkServers();
            setTimeout(() => {
                checkLocalStorage();
            }, 1000);
        }

        function doClearCache() {
            localStorage.clear();
            sessionStorage.clear();
            alert('‚úÖ Cache cleared! Press OK to reload the page.');
            location.reload(true);
        }

        function showConsoleHelp() {
            alert('Press F12 to open Developer Tools, then click the "Console" tab.\n\nLook for:\n‚Ä¢ Red error messages\n‚Ä¢ Yellow warning messages\n‚Ä¢ Failed network requests\n\nCopy any error messages you see!');
        }

        function collectDebugInfo() {
            const info = document.getElementById('debug-info');
            const debugData = {
                userAgent: navigator.userAgent,
                localStorage: Object.keys(localStorage).length + ' items',
                sessionStorage: Object.keys(sessionStorage).length + ' items',
                cookies: document.cookie.split(';').length + ' cookies',
                currentURL: window.location.href,
                timestamp: new Date().toISOString()
            };
            
            info.innerHTML = `
                <div class="result info">
                    <strong>üìä Debug Information:</strong><br><br>
                    <strong>Browser:</strong> ${debugData.userAgent}<br>
                    <strong>LocalStorage:</strong> ${debugData.localStorage}<br>
                    <strong>SessionStorage:</strong> ${debugData.sessionStorage}<br>
                    <strong>Cookies:</strong> ${debugData.cookies}<br>
                    <strong>Current URL:</strong> ${debugData.currentURL}<br>
                    <strong>Timestamp:</strong> ${debugData.timestamp}<br><br>
                    <button class="button" onclick="copyDebugInfo()">üìã Copy to Clipboard</button>
                </div>
            `;
        }

        function copyDebugInfo() {
            const text = 'Browser: ' + navigator.userAgent + '\nURL: ' + window.location.href + '\nTimestamp: ' + new Date().toISOString();
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Debug info copied to clipboard!');
            });
        }

        // Auto-run initial diagnostics
        window.addEventListener('load', () => {
            document.getElementById('diagnosis-status').innerHTML = '<span style="color: #fbbf24;">‚ö†Ô∏è Needs Investigation - Run Diagnostics Below</span>';
            
            // Auto-check if localStorage has old data
            if (Object.keys(localStorage).length > 0) {
                setTimeout(() => {
                    const warning = document.createElement('div');
                    warning.className = 'result warning';
                    warning.innerHTML = '‚ö†Ô∏è <strong>Warning:</strong> Found cached data in localStorage. This might be causing the error. Click "Clear All Cache & Reload" above!';
                    document.querySelector('.error-info').appendChild(warning);
                }, 1000);
            }
        });
    </script>
</body>
</html>